// I am not proud of this solution, but it works. Because of TT's javascript loading, the songlist is not ready on document ready. I wrote a listener to wait till songlist is ready. Any suggestions for improvement welcome.
$(document).ready(function(){songlistOnDOM();});function songlistOnDOM(){if ($(turntable.playlist.files).length > 0) {loadttTools();return;}else{setTimeout( songlistOnDOM, 100 );}}function loadttTools(){(function(a){var b=new Array;var c=new Array;a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),d=a(this).data("maxwidth"),e="",f=a(this),g=a("#"+a(this).data("tester_id"));if(e===(e=f.val())){return}var h=e.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");g.html(h);var i=g.width(),j=i+b.comfortZone>=c?i+b.comfortZone:c,k=f.width(),l=j<k&&j>=c||j>c&&j<d;if(l){f.width(j)}};a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width(),d=a(this).data("maxwidth")||b.maxInputWidth||a(this).closest(".tagsinput").width()-b.inputPadding,e="",f=a(this),g=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";if(!a("#"+h).length>0){g.attr("id",h);g.appendTo("body")}f.data("minwidth",c);f.data("maxwidth",d);f.data("tester_id",h);f.css("width",c)};a.fn.addTag=function(d,e){e=jQuery.extend({focus:false,callback:true},e);this.each(function(){var f=a(this).attr("id");var g=a(this).val().split(b[f]);if(g[0]==""){g=new Array}d=jQuery.trim(d);if(e.unique){var h=a(g).tagExist(d);if(h==true){a("#"+f+"_tag").addClass("not_valid")}}else{var h=false}if(d!=""&&h!=true){a("<span>").addClass("tag").append(a("<span>").text(d).append("  "),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+f).removeTag(escape(d))})).insertBefore("#"+f+"_addTag");g.push(d);a("#"+f+"_tag").val("");if(e.focus){a("#"+f+"_tag").focus()}else{a("#"+f+"_tag").blur()}a.fn.tagsInput.updateTagsField(this,g);if(e.callback&&c[f]&&c[f]["onAddTag"]){var i=c[f]["onAddTag"];i.call(this,d)}if(c[f]&&c[f]["onChange"]){var j=g.length;var i=c[f]["onChange"];i.call(this,a(this),g[j-1])}}});return false};a.fn.removeTag=function(d){d=unescape(d);this.each(function(){var e=a(this).attr("id");var f=a(this).val().split(b[e]);a("#"+e+"_tagsinput .tag").remove();str="";for(i=0;i<f.length;i++){if(f[i]!=d){str=str+b[e]+f[i]}}a.fn.tagsInput.importTags(this,str);if(c[e]&&c[e]["onRemoveTag"]){var g=c[e]["onRemoveTag"];g.call(this,d)}});return false};a.fn.tagExist=function(b){return jQuery.inArray(b,a(this))>=0};a.fn.importTags=function(b){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(d){var e=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},d);this.each(function(){if(e.hide){a(this).hide()}var d=a(this).attr("id");var f=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},e);b[d]=f.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange){c[d]=new Array;c[d]["onAddTag"]=e.onAddTag;c[d]["onRemoveTag"]=e.onRemoveTag;c[d]["onChange"]=e.onChange}var g='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';if(e.interactive){g=g+'<input id="'+d+'_tag" value="" data-default="'+e.defaultText+'" />'}g=g+'</div><div class="tags_clear"></div></div>';a(g).insertAfter(this);a(f.holder).css("width",e.width);a(f.holder).css("height",e.height);if(a(f.real_input).val()!=""){a.fn.tagsInput.importTags(a(f.real_input),a(f.real_input).val())}if(e.interactive){a(f.fake_input).val(a(f.fake_input).attr("data-default"));a(f.fake_input).css("color",e.placeholderColor);a(f.fake_input).resetAutosize(e);a(f.holder).bind("click",f,function(b){a(b.data.fake_input).focus()});a(f.fake_input).bind("focus",f,function(b){if(a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")){a(b.data.fake_input).val("")}a(b.data.fake_input).css("color","#000000")});if(e.autocomplete_url!=undefined){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete){autocomplete_options[attrname]=e.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){a(f.fake_input).autocomplete(e.autocomplete_url,e.autocomplete);a(f.fake_input).bind("result",f,function(b,c,f){if(c){a("#"+d).addTag(c[0]+"",{focus:true,unique:e.unique})}})}else if(jQuery.ui.autocomplete!==undefined){a(f.fake_input).autocomplete(autocomplete_options);a(f.fake_input).bind("autocompleteselect",f,function(b,c){a(b.data.real_input).addTag(c.item.value,{focus:true,unique:e.unique});return false})}}else{a(f.fake_input).bind("blur",f,function(b){var c=a(this).attr("data-default");if(a(b.data.fake_input).val()!=""&&a(b.data.fake_input).val()!=c){if(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length))a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:true,unique:e.unique})}else{a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default"));a(b.data.fake_input).css("color",e.placeholderColor)}return false})}a(f.fake_input).bind("keypress",f,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||b.which==13){b.preventDefault();if(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length))a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:true,unique:e.unique});a(b.data.fake_input).resetAutosize(e);return false}else if(b.data.autosize){a(b.data.fake_input).doAutosize(e)}});f.removeWithBackspace&&a(f.fake_input).bind("keydown",function(b){if(b.keyCode==8&&a(this).val()==""){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last").text();var d=a(this).attr("id").replace(/_tag$/,"");c=c.replace(/[\s]+x$/,"");a("#"+d).removeTag(escape(c));a(this).trigger("focus")}});a(f.fake_input).blur();if(f.unique){a(f.fake_input).keydown(function(b){if(b.keyCode==8||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){a(this).removeClass("not_valid")}})}}return false});return this};a.fn.tagsInput.updateTagsField=function(c,d){var e=a(c).attr("id");a(c).val(d.join(b[e]))};a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id");var g=e.split(b[f]);for(i=0;i<g.length;i++){a(d).addTag(g[i],{focus:false,callback:false})}if(c[f]&&c[f]["onChange"]){var h=c[f]["onChange"];h.call(d,d,g[i])}}})(jQuery);ttObjects={room:null,getRoom:function(){for(var a in turntable){var b=turntable[a];if(typeof b!=="object"||b===null)continue;if(typeof b.setupRoom!=="undefined"){ttObjects.room=b;return b}}return false},songCount:turntable.playlist.files.length-1,manager:null,getManager:function(){for(var a in ttObjects.getRoom()){var b=ttObjects.room[a];if(typeof b!=="object"||b===null)continue;if(typeof b.blackswan!=="undefined"){ttObjects.manager=b;return b}}return false},api:null,getApi:function(){var a=/ Preparing message /i;for(var b in turntable){var c=turntable[b];if(typeof c!=="function")continue;c.toString=Function.prototype.toString;if(a.test(c.toString())){ttObjects.api=c;return c}}return false}};ttTools={roomLoaded:function(){var a=$.Deferred();var b=function(){if(turntable&&ttObjects.getManager()&&ttObjects.getApi())return a.resolve();setTimeout(b,500)};b();return a.promise()},init:function(){$("<link/>",{type:"text/css",rel:"stylesheet",href:"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/sunny/jquery-ui.css"}).appendTo(document.head);this.views.menu.render();this.views.users.render();this.views.toolbar.render();this.views.playlist.render();$.when(ttTools.tags.playlistLoaded()).then($.proxy(ttTools.tags.init,ttTools.tags));this.portability.init();turntable.addEventListener("auth",$.proxy(this.authEvent,this));turntable.addEventListener("message",$.proxy(this.messageEvent,this));turntable.addEventListener("reconnect",$.proxy(this.reconnectEvent,this));turntable.addEventListener("userinfo",$.proxy(this.userInfoEvent,this));$("div#top-panel").next().find("a[id]").on("click",function(a){clearTimeout(ttTools.autoVote.timeout)});this.defaults();this.checkVersion()},defaults:function(){clearTimeout(this.autoDJ.timeout);clearTimeout(this.autoVote.timeout);this.userActivityLog.init();this.autoDJ.setEnabled(false);this.autoVote.setEnabled(this.autoVote.enabled());this.autoVote.execute();this.downVotes.downvotes=0;this.downVotes.downvoters=[];this.override_idleTime();this.override_removeDj();this.override_guestListName();this.override_updateGuestList();this.override_setPlaylistHeight();this.views.playlist.update();this.views.users.modifyContainer();ttObjects.room.updateGuestList();$.when(ttTools.tags.playlistLoaded()).then($.proxy(ttTools.tags.defaults,ttTools.tags))},authEvent:function(a){console.warn(a)},messageEvent:function(a){if(typeof a.msgid!=="undefined"){if(typeof a.users!=="undefined"&&typeof a.room==="object"&&typeof a.room.metadata==="object"&&typeof a.room.metadata.songlog!=="undefined"){return $.when(this.roomLoaded()).then($.proxy(this.roomChanged,this))}return}switch(a.command){case"speak":return this.userSpoke(a);case"update_votes":return this.votesUpdated(a);case"deregistered":return this.userRemoved(a);case"newsong":return this.songChanged(a);case"add_dj":return this.djAdded(a);case"booted_user":return this.userBooted(a);case"rem_dj":return this.djRemoved(a);case"playlist_complete":return this.playlistComplete(a);case"search_complete":return this.searchComplete(a);case"registered":case"snagged":case"update_user":return;default:return console.warn(a)}},reconnectEvent:function(a){console.warn(a)},userInfoEvent:function(a){console.warn(a)},djAdded:function(a){this.views.users.update()},djRemoved:function(a){$(a.user).each(function(a,b){ttTools.views.users.updateUser(b.userid)})},playlistComplete:function(a){this.views.playlist.update();this.tags.views.playlist.update()},roomChanged:function(){this.defaults()},searchComplete:function(a){this.tags.views.playlist.update()},songChanged:function(a){this.downVotes.downvoters=[];this.downVotes.downvotes=0;this.views.users.update();this.autoVote.execute();this.autoSongDrop.execute(a)},userBooted:function(a){delete this.userActivityLog[a.userid]},userRemoved:function(a){$(a.user).each(function(a,b){delete this.userActivityLog[b.userid]})},userSpoke:function(a){this.userActivityLog[a.userid].message=util.now();this.views.users.updateUser(a.userid)},votesUpdated:function(a){this.downVotes.update(a.room.metadata);this.views.users.updateVoteCount()},autoVote:{timeout:null,enabled:function(){var a=$.cookie("ttTools_autoVote_enabled");if(a===null||a==="false")return false;return a},setEnabled:function(a){$.cookie("ttTools_autoVote_enabled",a)},delay:function(){var a=$.cookie("ttTools_autoVote_delay");return a===null?30*ttTools.constants.time.seconds:parseInt(a)},setDelay:function(a){$.cookie("ttTools_autoVote_delay",a)},execute:function(){clearTimeout(this.timeout);var a=this.enabled();if(a){this.timeout=setTimeout(function(){if(ttObjects.room.currentSong){ttObjects.api({api:"room.vote",roomid:ttObjects.room.roomId,val:a,vh:$.sha1(ttObjects.room.roomId+a+ttObjects.room.currentSong._id),th:$.sha1(Math.random()+""),ph:$.sha1(Math.random()+"")})}},this.delay())}}},autoDJ:{timeout:null,enabled:function(){var a=$.cookie("ttTools_autoDJ_enabled");return a===null?false:a==="true"},setEnabled:function(a){$.cookie("ttTools_autoDJ_enabled",a)},delay:function(){var a=$.cookie("ttTools_autoDJ_delay");return a===null?2*ttTools.constants.time.seconds:parseInt(a)},setDelay:function(a){$.cookie("ttTools_autoDJ_delay",a)},execute:function(a){clearTimeout(this.timeout);if(this.enabled()&&a!==turntable.user.id&&!ttObjects.room.isDj()){this.timeout=setTimeout(function(){if(ttObjects.room.numDjs()<ttObjects.room.maxDjs){ttObjects.api({api:"room.add_dj",roomid:ttObjects.room.roomId},function(a){if(!a.success&&!ttObjects.room.isDj())return;ttTools.autoDJ.setEnabled(false);ttTools.views.toolbar.update()})}},this.delay())}}},animations:{enabled:function(){var a=$.cookie("ttTools_animations_enabled");return a===null?true:a==="true"},setEnabled:function(a){$.cookie("ttTools_animations_enabled",a);a?ttTools.animations.enable():ttTools.animations.disable()},speakers:$('.roomView img[src*="speaker"]').parent(),enable:function(){if(typeof BlackSwanCanvasDancer==="function"){ttObjects.manager.update_vote=ttObjects.voteAnim;ttObjects.manager.set_active_dj=ttObjects.djAnim;for(dj in ttObjects.manager.djs_uid){if(dj===ttObjects.room.currentDj){ttObjects.manager.djs_uid[dj][0].setAnimation("bob");ttObjects.manager.djs_uid[dj][0].start()}if($.inArray(dj,ttObjects.room.upvoters)!==-1){ttObjects.manager.djs_uid[dj][0].setAnimation("smallrock");ttObjects.manager.djs_uid[dj][0].start()}}for(listener in ttObjects.manager.listeners){if($.inArray(listener,ttObjects.room.upvoters)!==-1){ttObjects.manager.listeners[listener].setAnimation("rock");ttObjects.manager.listeners[listener].start()}}}else{ttObjects.manager.add_animation_to=ttObjects.danceAnim;for(dj in ttObjects.manager.djs_uid){if(dj===ttObjects.room.currentDj){ttObjects.manager.add_animation_to(ttObjects.manager.djs_uid[dj][0],"bob")}if($.inArray(dj,ttObjects.room.upvoters)!==-1){ttObjects.manager.add_animation_to(ttObjects.manager.djs_uid[dj][0],"rock")}}for(listener in ttObjects.manager.listeners){if($.inArray(listener,ttObjects.room.upvoters)!==-1){ttObjects.manager.add_animation_to(ttObjects.manager.listeners[listener],"rock")}}}ttTools.animations.speakers.show()},disable:function(){if(typeof BlackSwanCanvasDancer==="function"){ttObjects.voteAnim=ttObjects.manager.update_vote;ttObjects.djAnim=ttObjects.manager.set_active_dj;ttObjects.manager.update_vote=$.noop;ttObjects.manager.set_active_dj=function(a){ttObjects.djAnim.call(ttObjects.manager,a);ttObjects.manager.djs[a][1].stop()}}else{ttObjects.manager.add_animation_to_ttTools=ttObjects.manager.add_animation_to;ttObjects.manager.add_animation_to=$.noop}ttObjects.manager.speak_ttTools=ttObjects.manager.speak;ttObjects.manager.speak=$.noop;$(Object.keys(ttObjects.manager.djs_uid)).each(function(a,b){ttObjects.manager.djs_uid[b][0].stop()});$(Object.keys(ttObjects.manager.listeners)).each(function(a,b){ttObjects.manager.listeners[b].stop()});$('.roomView img[src*="speaker"]').each(function(a,b){speakers=$(b).parent()});ttTools.animations.speakers.hide()}},idleIndicator:{threshold:function(){var a=$.cookie("ttTools_idleIndicator_threshold");return a===null?60*ttTools.constants.time.minutes:parseInt(a)},setThreshold:function(a){$.cookie("ttTools_idleIndicator_threshold",a)}},autoSongDrop:{threshold:function(){var a=$.cookie("ttTools_autoSongDrop_threshold");return a===null?0:parseInt(a)},setThreshold:function(a){$.cookie("ttTools_autoSongDrop_threshold",a)},execute:function(a){if(!ttObjects.room.isDj())return;var b=a.room.metadata.current_song;if(b.djid===turntable.user.id)return;var c=turntable.playlist.files.slice(0,this.threshold());if(c.length===0)return;$(c).each(function(a,c){if(c.fileId!==b._id)return;ttTools.moveSongToBottom(c.fileId);return false})}},userActivityLog:{init:function(){var a=Object.keys(ttObjects.room.users);$(a).each(function(a,b){ttTools.userActivityLog.initUser(b)})},initUser:function(a){if(typeof ttTools.userActivityLog[a]==="undefined"){ttTools.userActivityLog[a]={message:util.now(),vote:util.now()}}return ttTools.userActivityLog[a]},vote:function(a){var b=ttTools.userActivityLog.initUser(a);return b.vote},message:function(a){var b=ttTools.userActivityLog.initUser(a);return b.message},averageActivity:function(a){var b=ttTools.userActivityLog.initUser(a),c=Object.keys(b),d=0;$(c).each(function(a,c){d+=b[c]});return util.now()-d/c.length}},downVotes:{downvotes:0,downvoters:[],update:function(a){this.downvotes=a.downvotes;$(a.votelog).each(function(a,b){if(b[0]==="")return;ttTools.userActivityLog[b[0]].vote=util.now();if(b[1]==="up"){var c=$.inArray(b[0],ttTools.downVotes.downvoters);if(c>-1){ttTools.downVotes.downvoters.splice(c,1)}}else{ttTools.downVotes.downvoters.push(b[0])}ttTools.views.users.updateUser(b[0])})}},override_setPlaylistHeight:function(){if(!turntable.playlist.setPlaylistHeight_ttTools)turntable.playlist.setPlaylistHeight_ttTools=turntable.playlist.setPlaylistHeight;turntable.playlist.setPlaylistHeight=function(a){var a=this.setPlaylistHeight_ttTools(a);return a}},override_guestListName:function(){if(!Room.layouts.guestListName_ttTools)Room.layouts.guestListName_ttTools=Room.layouts.guestListName;Room.layouts.guestListName=function(a,b,c){var d=this.guestListName_ttTools(a,b,c);var e=d[0].split(".");e[0]+="#"+a.userid;d[0]=e.join(".");return d}},override_updateGuestList:function(){if(!ttObjects.room.updateGuestList_ttTools)ttObjects.room.updateGuestList_ttTools=ttObjects.room.updateGuestList;ttObjects.room.updateGuestList=function(){this.updateGuestList_ttTools();ttTools.views.users.update()}},override_idleTime:function(){turntable.idleTime=function(){return 0}},override_removeDj:function(){if(!ttObjects.room.removeDj_ttTools)ttObjects.room.removeDj_ttTools=ttObjects.room.removeDj;ttObjects.room.removeDj=function(a){ttTools.autoDJ.execute();this.removeDj_ttTools(a)}},checkVersion:function(){if(parseInt($.cookie("ttTools_release"))!==ttTools.release.getTime()){$.cookie("ttTools_release",ttTools.release.getTime());this.views.info.render()}},timestamp:function(a){a=util.now()-a;if(a<ttTools.constants.time.minutes)return Math.round(a/ttTools.constants.time.seconds)+"s";if(a<ttTools.constants.time.hours)return Math.round(a/ttTools.constants.time.minutes)+"m";if(a<ttTools.constants.time.days)return Math.round(100*(a/ttTools.constants.time.hours))/100+"h";return Math.round(1e3*(a/ttTools.constants.time.days))/1e3+"d"},moveSongToBottom:function(a){console.log("moveSongToBottom");if($.inArray(a,Object.keys(turntable.playlist.songsByFid))===-1)return;var b=ttObjects.songCount;b+=ttObjects.room.currentDj===turntable.user.id?-1:0;$(turntable.playlist.files).each(function(c,d){if(d!==a)return;if(c===b)return false;turntable.playlist.files.splice(c,1);turntable.playlist.files.splice(b,0,d);turntable.playlist.updatePlaylist(null,true);ttObjects.api({api:"playlist.reorder",playlist_name:"default",index_from:c,index_to:b});return false})},moveSongRandom:function(a){console.log("moveSongRandom");if($.inArray(a,Object.keys(turntable.playlist.songsByFid))===-1)return;var b=ttObjects.songCount-1;b+=ttObjects.room.currentDj===turntable.user.id?-1:0;var c=Math.floor(Math.random()*b);$(turntable.playlist.files).each(function(d,e){if(e!==a)return;if(d===b)return false;turntable.playlist.files.splice(d,1);turntable.playlist.files.splice(c,0,e);turntable.playlist.updatePlaylist(null,true);ttObjects.api({api:"playlist.reorder",playlist_name:"default",index_from:d,index_to:b});return false})}};ttTools.views={menu:{render:function(){$('<div class="menuItem">ttTools</div>').click(function(a){ttTools.views.settings.render()}).insertBefore($("div#menuh").children().last())}},settings:{render:function(){util.showOverlay(util.buildTree(this.tree()));$("div.settingsOverlay.modal").append(ttTools.constants.submitIssue()).append(ttTools.constants.donateButton());$("<style/>",{type:"text/css",text:"div.settingsOverlay {  width:400px !important;  margin-top:15px !important;  padding:20px 20px 0 !important;}div.settingsOverlay .ui-slider {  height:0.5em;  margin:10px 0 3px;}div.settingsOverlay .ui-slider .ui-slider-handle {  width:0.9em;  height:0.9em;}div#idleIndicatorDisplay, div#autoDJDisplay, div#autoVoteDisplay { text-align:center; }      "}).appendTo($("div.settingsOverlay.modal"));$("div#autoSongDrop").slider({min:0,max:20,step:1,value:ttTools.autoSongDrop.threshold(),slide:function(a,b){ttTools.autoSongDrop.setThreshold(b.value);$("div#autoSongDropDisplay").text(b.value+" songs")}});$("div#idleIndicatorThreshold").slider({min:10*ttTools.constants.time.minutes,max:60*ttTools.constants.time.minutes,step:ttTools.constants.time.minutes,value:ttTools.idleIndicator.threshold(),slide:function(a,b){ttTools.idleIndicator.setThreshold(b.value);$("div#idleIndicatorDisplay").text(b.value/ttTools.constants.time.minutes+"m")}});$("div#autoDJDelay").slider({min:0,max:5*ttTools.constants.time.seconds,step:ttTools.constants.time.seconds/10,value:ttTools.autoDJ.delay(),slide:function(a,b){ttTools.autoDJ.setDelay(b.value);$("div#autoDJDisplay").text(b.value/ttTools.constants.time.seconds+"s")}});$("div#autoVoteDelay").slider({min:0,max:60*ttTools.constants.time.seconds,step:ttTools.constants.time.seconds,value:ttTools.autoVote.delay(),slide:function(a,b){ttTools.autoVote.setDelay(b.value);$("div#autoVoteDisplay").text(b.value/ttTools.constants.time.seconds+"s")}})},tree:function(){return["div.settingsOverlay.modal",{},["div.close-x",{event:{click:util.hideOverlay}}],["br"],["h1","ttTools"],["div",{},"Released: "+ttTools.release.toUTCString()],["br"],["div",{},["span",{},"Auto Song-Drop Threshold "],["a",{href:"http://tttools.html-5.me/help",target:"_blank"},"[?]"]],["div#autoSongDrop",{}],["div#autoSongDropDisplay",{},ttTools.autoSongDrop.threshold()+" songs"],["br"],["div",{},["span",{},"Idle Indicator Threshold "],["a",{href:"http://tttools.html-5.me/help",target:"_blank"},"   [?]"]],["div#idleIndicatorThreshold",{}],["div#idleIndicatorDisplay",{},ttTools.idleIndicator.threshold()/ttTools.constants.time.minutes+"m"],["br"],["div",{},"Auto DJ Delay"],["div#autoDJDelay",{}],["div#autoDJDisplay",{},ttTools.autoDJ.delay()/ttTools.constants.time.seconds+"s"],["br"],["div",{},"Auto Vote Delay"],["div#autoVoteDelay",{}],["div#autoVoteDisplay",{},ttTools.autoVote.delay()/ttTools.constants.time.seconds+"s"],["br"]]}},info:{render:function(){turntable.showAlert();$("<style/>",{type:"text/css",text:"div.modal { margin-top:15px !important; }div.modal ul li {  font-size:16px;  text-align:left;}div.modal ul {  padding-left:10px;}      "}).appendTo($("div.modal"));$("div.modal div:first").html("").append(ttTools.constants.whatsNew()).append(ttTools.constants.submitIssue()).append(ttTools.constants.donateButton())}},toolbar:{render:function(){turntable.playlist.setPlaylistHeight($("div.chat-container").css("top").replace("px",""));$("<style/>",{type:"text/css",text:"div.queueView div.songlist { top:95px !important; }div.queueView div.resultsLabel {  top:65px !important;  height:20px !important;  padding-top:7px !important;  background-color:#CCC !important;}div#playlistTools {  left:0;  right:0;  top:36px;  height:2em;  padding:2px 0;  position:absolute;  background:#ccc}div#songs {  top: 64px !important;}div#playlistTools div { float:left; }div#playlistTools label { font-size:5px; }div#playlistTools div#buttons { margin:0 12px; }div#playlistTools div#buttons .ui-button-text { padding:2px 3px; }div#playlistTools div#buttons button { width:auto; height:auto; margin-right:-1px; }div#playlistTools div#buttons button .ui-button-text { padding:10px 11px; }div#playlistTools .custom-icons { background:url("+ttTools.resources.customIcons+"); }div#playlistTools .custom-icons.youtube { background-position:0 0; }div#playlistTools .custom-icons.dice { background-position:17px 0; }div#playlistTools .custom-icons.soundcloud { background-position:34px 0; }      "}).appendTo(document.head);$(util.buildTree(this.tree())).insertAfter($("#queue-header"));$("div#buttons").buttonset();$("input#autoAwesome").click(function(a){if(ttTools.autoVote.enabled()!=="up")ttTools.autoVote.setEnabled("up");else ttTools.autoVote.setEnabled("false");ttTools.views.toolbar.update();ttTools.autoVote.execute()}).prop("checked",ttTools.autoVote.enabled()==="up").button("refresh");$("input#autoLame").click(function(a){if(ttTools.autoVote.enabled()!=="down")ttTools.autoVote.setEnabled("down");else ttTools.autoVote.setEnabled("false");ttTools.views.toolbar.update();ttTools.autoVote.execute()}).prop("checked",ttTools.autoVote.enabled()==="down").button("refresh");$("input#autoDJ").click(function(a){ttTools.autoDJ.setEnabled(!ttTools.autoDJ.enabled());ttTools.autoDJ.execute()}).prop("checked",ttTools.autoDJ.enabled()).button("refresh");if(ttTools.animations){$("input#animations").click(function(a){ttTools.animations.setEnabled(!ttTools.animations.enabled())}).prop("checked",ttTools.animations.enabled()).button("refresh")}$("button#youtube").button({text:false,icons:{primary:"custom-icons youtube"}}).click(function(a){if(!ttObjects.room.currentSong)return;var b=ttObjects.room.currentSong.metadata;var c="http://www.youtube.com/results?search_query=";c+=encodeURIComponent(b.artist+" - "+b.song);window.open(c,"_blank")});$("button#soundcloud").button({text:false,icons:{primary:"custom-icons soundcloud"}}).click(function(a){if(!ttObjects.room.currentSong)return;var b=ttObjects.room.currentSong.metadata;var c="http://soundcloud.com/search?q[fulltext]=";c+=encodeURIComponent(b.artist+" - "+b.song);window.open(c,"_blank")});$("button#casinoRoll").button({text:false,icons:{primary:"custom-icons dice"}}).click(function(a){$("div.chat-container form input").val("roll").parent().submit()});$("button#showTheLove").button({text:false,icons:{primary:"ui-icon-heart"}}).click(function(a){var b=200*Object.keys(ttObjects.room.users).length;for(user in ttObjects.room.users){setTimeout(function(a){ttObjects.manager.show_heart(a)},Math.round(Math.random()*b),user)}});$("button#importExport").button({text:false,icons:{primary:"ui-icon-transferthick-e-w"}}).click(function(a){ttTools.portability.views.modal.render()})},tree:function(){return["div#playlistTools",{},["div#buttons",{},["input#autoAwesome",{type:"checkbox"}],["label",{"for":"autoAwesome"},["span.ui-icon.ui-icon-circle-arrow-n",{title:"Automatically upvote songs"}]],["input#autoLame",{type:"checkbox"}],["label",{"for":"autoLame"},["span.ui-icon.ui-icon-circle-arrow-s",{title:"Automatically downvote songs"}]],["input#autoDJ",{type:"checkbox"}],["label",{"for":"autoDJ"},["span.ui-icon.ui-icon-person",{title:"Attempt to get the next DJ spot"}]],["input#animations",{type:"checkbox"}],["label",{"for":"animations"},["span.ui-icon.ui-icon-video",{title:"Toggle animations on/off"}]],["button#youtube",{title:"Search YouTube"}],["button#soundcloud",{title:"Search SoundCloud"}],["button#casinoRoll",{title:"Roll for a spot (casino mode)"}],["button#showTheLove",{title:"Show The Love"}],["button#importExport",{title:"Import/Export"}]]]},update:function(){$("#autoDJ").prop("checked",ttTools.autoDJ.enabled()).button("refresh");$("#autoAwesome").prop("checked",ttTools.autoVote.enabled()==="up").button("refresh");$("#autoLame").prop("checked",ttTools.autoVote.enabled()==="down").button("refresh")}},users:{render:function(){$("<style/>",{type:"text/css",text:"div.guest.upvoter { background-color:#aea !important;}div.guest.upvoter:hover { background-color:#cec !important; }div.guest.downvoter { background-color:#eaa !important; }div.guest.downvoter:hover { background-color:#ecc !important; }div.guest.current_dj { background-color:#ccf !important; }div.guest.current_dj:hover { background-color:#ddf !important; }div.guestName .emoji { padding:3px 0; margin-left:3px; }div.guestName .status {  padding:0 7px;  margin:0 3px 0 -3px;  background-image:url('https://s3.amazonaws.com/static.turntable.fm/images/pm/status_indicators_depth.png');}div.guestName .status.green { background-position:0 0; }div.guestName .status.yellow { background-position:0 -13px; }div.guestName .status.grey { background-position:0 -26px; }div.guestName .status.red { background-position:0 -39px; }div#voteCount {  position:absolute;  top:3px;  right:20px;  font-size:12px;  text-shadow:-1px 0 black,0 1px black,1px 0 black,0 -1px black;}div#voteCount span.up { color:#aea; }div#voteCount span.down { color:#eaa; }div.guestButton {  width: 35px;  height: 36px;  cursor: pointer;  background:none;  position: absolute;  border: 0;  border-left: 1px solid #D0D0D0;  border-right: 1px solid #7B7B7B;}div.guestButton.popout { left: 36px; }div.ui-icon { margin:10px; }div.guestListSize {  left:73px !important;  width:157px !important;  font-size:11px !important;}div#guestDialog { padding:0; }div#guestDialog div.guest-list-container {  top:auto !important;  height:auto !important;  position:relative;}div#guestDialog div.guest-list-container div.guests {  top:0;  height:auto !important;  overflow:hidden;  background:none;  position:relative;}      "}).appendTo(document.head);$("<div/>",{id:"guestDialog"}).appendTo(document.body);this.setupDialog()},setupDialog:function(){$("div#guestDialog").dialog({width:285,height:350,title:" people are in this room",autoOpen:false,open:function(a,b){$("div.chat-container div.guestListButton").hide();$("div.chat-container div.guestButton").show();$("div.guest-list-container").appendTo(this);$("div.guest-list-container div.chatBar").hide();$("div.guest-list-container div.chatHeader").hide();$("div#guestDialog").prev().find("span:first").prepend($("span#totalUsers"))},close:function(a,b){$("div.chat-container div.guestListButton").show();$("div.chat-container div.guestButton").hide();$("div.guest-list-container").appendTo($("div#right-panel"));$("div.guest-list-container div.chatBar").show();$("div.guest-list-container div.chatHeader").show();$("span#totalUsers").prependTo("div.guestListSize")}})},update:function(){ttTools.views.users.updateVoteCount();$("div.guests .guest").each(function(a,b){ttTools.views.users.updateUser(b.id)})},modifyContainer:function(){$("<div/>",{id:"voteCount"}).appendTo($("div.chatHeader"));$("div.guest-list-container div.guestListButton").after($("<div/>",{"class":"guestButton ui-state-default popout"}).append($("<div/>",{"class":"ui-icon ui-icon-newwin"})).bind("click",function(a){$("div#guestDialog").dialog("open")}));$("div.chat-container div.guestListButton").after($("<div/>",{"class":"guestButton ui-state-default",style:"border-left:0;"}).hide().append($("<div/>",{"class":"ui-icon ui-icon-pin-w"})).bind("click",function(a){$("div#guestDialog").dialog("close")}))},updateVoteCount:function(){$("div#voteCount").html("").append(util.emojify(":thumbsup:")).append($("<span/>",{"class":"up"}).html(ttObjects.room.upvoters.length)).append("   ").append(util.emojify(":thumbsdown:")).append($("<span/>",{"class":"down"}).html(ttTools.downVotes.downvotes))},updateUser:function(a){var b=$("div#"+a);var c=b.find("div.guestName");var d=ttObjects.room.users[a];b.find("span").remove();b.attr("class","guest");if(a===ttObjects.room.currentDj)b.addClass("current_dj");if($.inArray(a,ttObjects.room.upvoters)>-1)b.addClass("upvoter");if($.inArray(a,ttTools.downVotes.downvoters)>-1)b.addClass("downvoter");c.prepend($("<span/>").addClass("status").addClass(ttTools.views.users.userStatus(a)).hover(function(b){var c="Last spoke "+ttTools.timestamp(ttTools.userActivityLog.message(a))+" ago";c+="\n";c+="Last voted "+ttTools.timestamp(ttTools.userActivityLog.vote(a))+" ago";$(this).attr("title",c).attr("class","status").addClass(ttTools.views.users.userStatus(a))}));if(d.verified)c.append($(util.emojify(":tophat:")).attr("title","Verified "+d.verified));if($.inArray(a,ttTools.constants.hackers)>-1)c.append($(util.emojify(":octocat:")).attr("title","turntable.fm hacker"));if($.inArray(a,ttObjects.room.djIds)>-1)c.append($(util.emojify(":notes:")).attr("title","Is on the decks"))},userStatus:function(a){var b=ttTools.userActivityLog.averageActivity(a);var c=ttTools.idleIndicator.threshold();if(b>c)return"red";if(b>c/2)return"yellow";return"green"}},playlist:{render:function(){$("<style/>",{type:"text/css",text:"#playlist .song .goTop {  top:2px !important;  left:12px !important;}#playlist .song .goBottom {  top:22px;  left:2px;  width:34px;  height:17px;  cursor:pointer;  position:absolute;  background-position:0 17px !important;  background:url("+ttTools.resources.bottomButton+");}#playlist .song .goBottom:hover { background-position:0 0 !important; }#playlist .song.topSong .goBottom { display:none; }      "}).appendTo(document.head)},update:function(){$(".goTop").after('<div class="goBottom"/>')}}};ttTools.database={dbName:"ttTools.database",dbDisplayName:"ttTools Database",dbVersion:"1.0",dbMaxSize:1e7,dbHandle:false,isSupported:function(){return window.openDatabase?true:false},getDatabase:function(){try{if(this.dbHandle){return this.dbHandle}this.dbHandle=openDatabase(this.dbName,this.dbVersion,this.dbDisplayName,this.dbMaxSize)}catch(a){if(a==2){alert("Invalid database version.")}else{alert("Unknown error "+a+".")}}return this.dbHandle},execute:function(a,b,c){console.log(a);this.getDatabase().transaction(function(d){d.executeSql(a,[],b,c)})}};ttTools.tags={dbTable:"tags",playlistLoaded:function(){var a=$.Deferred();var b=function(){if(turntable&&turntable.playlist&&turntable.playlist.files)return a.resolve();setTimeout(b,500)};b();return a.promise()},init:function(){$("<style/>",{type:"text/css",text:"div.tagsinput { border:1px solid #CCC; background: #FFF; padding:5px; width:300px; height:100px; overflow-y: auto;}div.tagsinput span.tag { border: 1px solid #a5d24a; -moz-border-radius:2px; -webkit-border-radius:2px; display: block; float: left; padding: 5px; text-decoration:none; background: #cde69c; color: #638421; margin-right: 5px; margin-bottom:5px;font-family: helvetica;  font-size:13px;}div.tagsinput span.tag a { font-weight: bold; color: #82ad2b; text-decoration:none; font-size: 11px;  }div.tagsinput input { width:80px; margin:0px; font-family: helvetica; font-size: 13px; border:1px solid transparent; padding:5px; background: transparent; color: #000; outline:0px;  margin-right:5px; margin-bottom:5px; }div.tagsinput div { display:block; float: left; }.tags_clear { clear: both; width: 100%; height: 0px; }.not_valid {background: #FBD8DB !important; color: #90111A !important;}      "}).appendTo(document.head);this.createTable();this.views.playlist.render();this.defaults()},defaults:function(){this.views.playlist.update();this.override_filterQueue()},override_filterQueue:function(){if(!turntable.playlist.filterQueue_ttTools)turntable.playlist.filterQueue_ttTools=turntable.playlist.filterQueue;turntable.playlist.filterQueue=function(a){turntable.playlist.filterQueue_ttTools(a);if(a.length>0){ttTools.tags.getFidsForTagLike(a,function(a,b){var c=[];for(var d=0;d<b.rows.length;d++){c.push(b.rows.item(d).fid)}$("div.queue div.song:hidden").each(function(a,b){var b=$(b);var d=b.data("songData").fileId;if($.inArray(d,c)>-1)b.closest(".song").show().addClass("filtered")})})}}},createTable:function(){ttTools.database.execute("CREATE TABLE IF NOT EXISTS "+this.dbTable+"("+"id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,"+"fid TEXT NOT NULL,"+"tag TEXT NOT NULL"+");")},resetData:function(){ttTools.database.execute("DROP TABLE IF EXISTS "+this.dbTable+";");this.createTable();this.addTag("4dd6c222e8a6c404330002c5","trololo");this.views.playlist.update()},getAll:function(a,b){return ttTools.database.execute("SELECT DISTINCT fid, tag FROM "+this.dbTable+";",a,b)},getFids:function(a,b){return ttTools.database.execute("SELECT DISTINCT fid FROM "+this.dbTable+";",a,b)},getFidsForTag:function(a,b,c){return ttTools.database.execute("SELECT DISTINCT fid FROM "+this.dbTable+' WHERE tag="'+a+'";',b,c)},getFidsForTagLike:function(a,b,c){return ttTools.database.execute("SELECT DISTINCT fid FROM "+this.dbTable+' WHERE tag LIKE "%'+a+'%";',b,c)},getTagsForFid:function(a,b,c){return ttTools.database.execute("SELECT DISTINCT tag FROM "+this.dbTable+' WHERE fid="'+a+'";',b,c)},addTag:function(a,b,c,d){return ttTools.database.execute("INSERT INTO "+this.dbTable+' (fid,tag) VALUES("'+a+'", "'+b+'");',c,d)},removeTag:function(a,b,c,d){return ttTools.database.execute("DELETE FROM "+this.dbTable+' WHERE fid="'+a+'" AND tag="'+b+'";',c,d)}};ttTools.tags.views={playlist:{render:function(){$("<style/>",{type:"text/css",text:".song .ui-icon-tag{  margin: 0;  top: 0;  right: 0;  width: 16px;  height: 16px;  cursor: pointer;  position: absolute;}.song-list .song .title {  height: 35px !important;  width: 145px; z-index:2; }      "}).appendTo(document.head)},update:function(){$(".song .ui-icon-tag").remove();var a=$(".song .title").unbind("click").on("click",function(a){ttTools.tags.views.add.render($(this).closest(".song").data("songData"))});ttTools.tags.getFids(function(b,c){var d=[];for(var e=0;e<c.rows.length;e++){d.push(c.rows.item(e).fid)}a.each(function(a,b){b=$(b);var c=b.closest(".song").data("songData").fileId;if($.inArray(c,d)>-1){$("<div/>",{"class":"ui-icon ui-icon-tag",title:"This song is ttTagged"}).appendTo(b)}})})}},add:{render:function(a){util.showOverlay(util.buildTree(this.tree(a)));ttTools.tags.getAll(function(b,c){var d={};for(var e=0;e<c.rows.length;e++){d[c.rows.item(e).tag]=1}var d=Object.keys(d);$("#tags").tagsInput({width:"100%",onAddTag:function(b){ttTools.tags.addTag(a.fileId,b)},onRemoveTag:function(b){ttTools.tags.removeTag(a.fileId,b)},autocomplete_url:false,autocomplete:{source:d}})});ttTools.tags.getTagsForFid(a.fileId,function(a,b){for(var c=0;c<b.rows.length;c++){$("#tags").addTag(b.rows.item(c).tag,{callback:false})}})},tree:function(a){return["div.tagsOverlay.modal",{},["div.close-x",{event:{click:function(){util.hideOverlay();ttTools.tags.views.playlist.update()}}}],["br"],["h1",a.metadata.song],["div",{},a.metadata.artist],["br"],["input#tags",{type:"text"}]]}}};ttTools.portability={init:function(){this.views.import.render()},importProcess:{operations:[],completed:0,timeout:null},importPlaylist:function(a){if(a.length==0){return this.views.import.update()}this.importProcess.operations=[];this.importProcess.completed=0;$(a).each(function(a,b){if($.inArray(b.fileId,Object.keys(turntable.playlist.songsByFid))>-1){return}var c=function(a){a=a==undefined?1:a;if(a>3){ttTools.portability.importOperations.splice(ttTools.portability.importProcess.completed,1);ttTools.portability.views.import.update()}var d=function(){c(a++)};ttTools.portability.importProcess.timeout=setTimeout(d,1e4);var e=function(d){clearTimeout(ttTools.portability.importProcess.timeout);if(!d.success){return c(a++)}ttTools.portability.importProcess.completed++;ttTools.portability.views.import.update();turntable.playlist.files.push(b);turntable.playlist.songsByFid[b.fileId]=b;turntable.playlist.updatePlaylist();if(ttTools.database.isSupported()&&b.tags){ttTools.tags.getTagsForFid(b.fileId,function(a,c){var d=[];for(var e=0;e<c.rows.length;e++){d.push(c.rows.item(e).tag)}$(b.tags).each(function(a,c){if($.inArray(c,d)<0){ttTools.tags.addTag(b.fileId,c,function(a,b){ttTools.tags.views.playlist.update()})}})})}if(ttTools.portability.importProcess.operations[ttTools.portability.importProcess.completed]){ttTools.portability.importProcess.operations[ttTools.portability.importProcess.completed]()}};var f=function(){ttObjects.api({api:"playlist.add",playlist_name:"default",index:turntable.playlist.files.length+1,song_dict:{fileid:b.fileId}},e)};setTimeout(f,1500)};ttTools.portability.importProcess.operations.push(c)});if(this.importProcess.operations.length==0){return this.views.import.update()}this.importProcess.operations[0]()},exportPlaylist:function(a){if(!ttTools.database.isSupported()||a.length<2&&a[0]==""){var b="Download All Files "+"<br /><br /> <a href='data:text/json;charset=utf-8,"+JSON.stringify(turntable.playlist.files)+'\'> Download Tagged Files </a><br /><small>Right-click the link above and select "Download Linked Content"</small>';$("<div id='dialog' title='Tagged Files'>"+b+"</div>").dialog({width:460});return}ttTools.tags.getAll(function(b,c){var d={},e=[];for(var f=0;f<c.rows.length;f++){if(d[c.rows.item(f).fid]){d[c.rows.item(f).fid].push(c.rows.item(f).tag)}else{d[c.rows.item(f).fid]=[c.rows.item(f).tag]}if($.inArray(c.rows.item(f).tag,a)>-1){e.push(c.rows.item(f).fid)}}var g=[];$(turntable.playlist.files).each(function(a,b){if($.inArray(b,e)>-1)g.push(b)});if(g.length<1){return turntable.showAlert("You have no music tagged with "+a.join(", "))}else{var h="Files tagged with "+a.join(", ")+"<br /><br /> <a href='data:text/json;charset=utf-8,"+JSON.stringify(g)+'\'> Download Tagged Files </a><br /><small>Right-click the link above and select "Download Linked Content"</small>';$("<div id='dialog' title='Tagged Files'>"+h+"</div>").dialog({width:460})}})}};ttTools.portability.views={"import":{render:function(){$("<style/>",{type:"text/css",text:"div#importProgress {  top:0;  left:0;  color:#fff;  width:400px;  padding:20px;  z-index:1000;  text-align:center;  position:absolute;  background-color:#888;  border:13px solid #fbd863;  text-shadow:1px 1px 1px black;}      "}).appendTo(document.head);$(util.buildTree(this.tree())).appendTo(document.body).draggable().hide().find("div#importProgressBar").progressbar()},update:function(){var a=ttTools.portability.importProcess.operations.length;var b=ttTools.portability.importProcess.completed;$("span#importTotal").html(a);$("span#importCount").html(b);$("div#importProgressBar").progressbar("option","value",b/a*100);if(b==a){if(ttTools.database.isSupported())ttTools.tags.views.playlist.update();$("div#importProgress").hide()}},tree:function(){return["div#importProgress",{},["span#status",{},"Processing..."],["div#importProgressBar",{}],["span#importCount",{},"0"],["span",{}," of "],["span#importTotal",{},"0"],["div",{},"Please be patient, this process is slow. Feel free to drag this dialog out of the way."]]}},modal:{render:function(){util.showOverlay(util.buildTree(this.tree()));$("<style/>",{type:"text/css",text:"div.portability.modal.dropzone { border-style:dotted; }div.portability.modal.dropzone * { visibility: hidden; }div.portability.modal ul { text-align: left; padding-left:10px;}div.portability.modal div.rightAlign { text-align: right; }      "}).appendTo($("div.portability.modal"));ttTools.tags.getAll(function(a,b){var c={};for(var d=0;d<b.rows.length;d++){c[b.rows.item(d).tag]=1}var c=Object.keys(c);$("input#tagExport").tagsInput({width:"100%",defaultText:"Export tags",autocomplete_url:false,autocomplete:{source:c}})});$("button#tagExportButton").button().click(function(a){var b=$("input#tagExport").val().split(",");util.hideOverlay();ttTools.portability.exportPlaylist(b)});$("div.portability.modal").on("dragenter",function(a){$(this).addClass("dropzone")}).on("dragleave",function(a){$(this).removeClass("dropzone")}).on("dragover",function(a){a.preventDefault()}).on("drop",function(a){a=a.originalEvent;util.hideOverlay();for(var b=0;b<a.dataTransfer.files.length;b++){var c=a.dataTransfer.files[b];if(typeof FileReader=="undefined"){var d="<b>Sorry</b><br />This action is not supported in your brower currently";$("<div id='dialog' title='Not Supported'>"+d+"</div>").dialog();return}else{var e=new FileReader}e.onload=function(){$("div#importProgress").show().find("span#status").html("Processing: "+c.name);try{ttTools.portability.importPlaylist(JSON.parse(this.result))}catch(a){$("div#importProgress").hide();alert(c.name+" cannot be imported as a playlist.")}};e.readAsText(c,"utf-8")}})},tree:function(){return["div.portability.modal",{},["div.close-x",{event:{click:util.hideOverlay}}],["br"],["h1","Import/Export"],["br"],["ul",{},["li",{},"To import a playlist, simply drag & drop the file on this dialog"],["li",{},"To export your entire playlist, just click export."],["li",{},"To only export songs with specific tags, enter them in the field below, then click export."]],["br"],["input#tagExport",{type:"text"}],["br"],["div.rightAlign",{},["button#tagExportButton","Export"]]]}}};ttTools.constants={whatsNew:function(){return"<h2>ttTools is back in business!</h2><br /><h3>"+ttTools.constants.months[ttTools.release.getMonth()]+" "+ttTools.release.getDate()+", "+ttTools.release.getFullYear()+'</h3><ul>	<li>TTtools has been updated to work with the latest update of Turntable.fm</li>	<li>New Website - <a href="http://tttools.html-5.me/" target="_blank">ttTools.html-5.me</a></li></ul><br/>'},donateButton:function(){return"<h3>Donate to the original author of ttTools</h3><form action='https://www.paypal.com/cgi-bin/webscr' method='post' target='_blank'><input type='hidden' name='cmd' value='_s-xclick'><input type='hidden' name='hosted_button_id' value='ZNTHAXPNKMKBN'><input type='image' src='https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif' border='0' name='submit' alt='PayPal - The safer, easier way to pay online!'><img alt='' border='0' src='https://www.paypalobjects.com/en_US/i/scr/pixel.gif' width='1' height='1'></form><br />"},submitIssue:function(){return"<h3>Found a bug? Want a feature?</h3><p>  It's impossible to keep track of bugs and feature requests unless they're centralized.<br/><br/>  <a href='https://github.com/JNehlsen/ttTools/issues' target='_blank'>Please submit all bugs and feature requests here.</a></p><br/>"},time:{seconds:1e3,minutes:60*1e3,hours:60*60*1e3,days:24*60*60*1e3,weeks:7*24*60*60*1e3,months:30*7*24*60*60*1e3,years:365*30*7*24*60*60*1e3},months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],hackers:["4deadb0f4fe7d013dc0555f1","4e10fde04fe7d074cd0d8b95","4e42c21b4fe7d02e6107b1ff","4e55144e4fe7d02a3f2c486a","4dee9d454fe7d0589304d644","4e6498184fe7d042db021e95","4e0b4de14fe7d076b205e657","4e596d44a3f7517501058e25","4e09dc63a3f7517d140c300d","4ddb2be9e8a6c45f6f000125","4dee6cd24fe7d05893018656","4e0ff328a3f751670a084ba6","4eeb7653590ca257710024c0"]};ttTools.resources={customIcons:"data:image/png;base64,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",bottomButton:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAjCAYAAADxG9hnAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGNzdGMTE3NDA3MjA2ODExODhDNkVBNURFMTFBNjMxNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGOEY5RTg3NDcxNzcxMUUxOTZFQkQwNDQ5QUJBNzAwNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGOEY5RTg3MzcxNzcxMUUxOTZFQkQwNDQ5QUJBNzAwNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAyODAxMTc0MDcyMDY4MTE4QzE0RjFDOUZFMkU2MUFDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY3N0YxMTc0MDcyMDY4MTE4OEM2RUE1REUxMUE2MzE3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+aPVoDAAAArNJREFUeNrslktvUkEUx2fuvTx1QwmG2l3lG5CwYCMadMmiCca4M32QmuBrUfoRrC58JW3oI+7USOKCpRDFDQvi/QbYbYmEslHe945n2nOT0TRleFWbcJKTO8zc+c/vnhkmf8oYIzLxftGzqVKyqlCp14kJsgYjW7f36vdk3teIZDg0krzoUOZsKon1Y+Gf1jVI9mfbTMrqU9mK8PiUnHEBTEFTSYieAtEzSAkgIjdfHzYnAsIjf9/ru+CgRU0hgZPGeyYp/2qzcPRVrTqI7sAgPD4/8AbcdlpUFeIT+w2TVBsdFr7+slYeVHMoEB5fHnpDAFOAw+vCw9kEiMi1F7XSMHpDg/D4+sgbc9roR95uddnC1ee17LBaI4EgzGN4qADxbBSdkUHGFf8PSGnNm4LnE8gZyLrkvBVID+QGZBAyDrk+CogyxBwOkBZ+8/b8qBURQXJ4MX7DxawvP8T+HC5oQfAqpoSKfBD6GabVlxK0La2c0P4DZAO3x4NiQVyUl9y60blwAtvrOEeHzEDewgU5/BXUCqIWEebw+VF+SUPewHZcBMnjGamjQBT7M8J4sE+F+fg+Zh0ho8K4LpzDvHgmRZA4VsODE/JCP0FBvQ+Ijts3jzpBQUf6jFjnYR9LqGMZrT0nWP46iltnJIOwOdyqbcjvqKXL/pvO34V25+mlTUUlq1TSoXFZ0yBbb9d+jNehaXaadLjpnKLRGJGwaGaPZdsNNhmHtpT2u+xuWlBVGiKnWDTDYKVOg0V2E5XJObTlHb/P7lKKsE0nOjTYjnKnaYZ3liuTd2gru/6AzXkE4/sLotptmeHtpcrZObTE3mzI5qQFqhw7NGaSZrfFIunFg7N3aIk3szGb/dihdTtsIX334N85NIA5cmgAMXVoYw0t+e7y1KFNHdrUoZ1Lh/ZbgAEA9opWGtX4ApQAAAAASUVORK5CYII="};ttTools.release=new Date(13470624e5);$.when(ttTools.roomLoaded()).then($.proxy(ttTools.init,ttTools));$("#songs").scroll(function(){$(".songs .song .goBottom").remove();$(".goTop").after('<div class="goBottom"/>');ttTools.tags.views.playlist.update()});$("#songs").on("click",".goBottom",function(a){var b=$(a.target);a.stopPropagation();var c=b.closest(".song").data("songData");ttTools.moveSongToBottom(c.fileId)})}